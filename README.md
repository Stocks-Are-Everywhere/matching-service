# Matching-service

### 🔖 서비스 개요
  - **주제**: 주문 매칭 및 체결 엔진
  - **주요 역할**: 
    - 매수/매도 주문 매칭 알고리즘 구현
    - 실시간 호가창 관리
    - 체결 처리 및 이벤트 발행
    - 시장 데이터와 사용자 주문 통합 처리

</br>

### 🌏 주요 로직
<img width="1157" alt="매칭 서비스 흐름도" src="" />

</br>
</br>

### 🔗 주요 기능  

#### 1️⃣ 주문 매칭 엔진
- FIFO(First In First Out) 기반 주문 매칭 알고리즘 구현
- 실시간 매수/매도 주문 처리 및 우선순위 큐 관리
- ReentrantLock을 활용한 동시성 제어 및 성능 최적화

#### 2️⃣ 호가창 관리
- 실시간 호가 정보 관리 및 업데이트 메커니즘
- KIS 데이터와 사용자 주문을 통합한 호가창 구성
- WebSocket을 통한 실시간 호가 정보 브로드캐스팅

#### 3️⃣ 체결 처리
- 매칭된 주문의 체결 로직 구현 및 처리
- 체결 이벤트 발행 및 관련 서비스(주문, 사용자) 통보
- 체결 내역 저장 및 관리 시스템 구축

#### 4️⃣ 시장 데이터 처리
- 실제 시장 데이터 수집 및 처리 파이프라인
- 15초봉, 1분봉 등 다양한 시간대별 차트 데이터 생성
- OHLC(시가, 고가, 저가, 종가) 데이터 관리 및 제공

#### 5️⃣ 성능 최적화
- 고성능 매칭 처리를 위한 자료구조 최적화
- 다중 스레드 환경에서의 안정적인 동작 보장
- 대용량 주문 처리를 위한 메모리 및 CPU 사용 최적화



</br>

### 🌈 개선 사항

  #### 1️⃣ 배치 성능 최적화 - <ins>실행 시간 약 84% 감소</ins>

  </br>

  **문제 상황**
  - 정기 결제 및 사용권 초기화를 배치로 처리하고 있는데, 현재는 배치 로직도 엄청 복잡하지 않고, 데이터 양도 많지 않지만, 나중에 데이터가 많아지게될 경우 성능 저하가 우려됨

  **1. 순차처리 → 병렬처리**
  - 기존에 순차적으로 진행하던 작업을 병렬로 처리

  **결과**
  
  <img width="742" alt="스크린샷 2024-12-17 15 33 20" src="https://github.com/user-attachments/assets/ef411e3b-e757-47df-8572-8102f83dc10d" />

</br>  

  #### 3️⃣ GitHub API를 통해 사용자 레포지토리 목록 조회 성능 개선 - <ins>응답속도 약 60배 개선</ins>
  
</br>

  **문제 상황**
  - GitHub API를 사용해서 조회하는 것인데

</br>

  **문제 해결**
  - 레포지토리 목록은 

</br>

  #### 4️⃣ 검색 필터 조회 성능 개선 - <ins>약 55.4% 개선</ins>
  - 캐싱 시도
    - 필터 자체를 캐싱하자니 Cache Hit 확률이 너무 낮아 성능 개선이 안됨
   
</br>

  **<개선 전>**
  <img width="1337" alt="스크린샷 2024-11-12 11 06 11" src="https://github.com/user-attachments/assets/c8d814f9-6273-4dc6-86c2-750fbef3c266">


  **<개선 후>**

</br>

### 🚀 트러블 슈팅

  #### 1️⃣ **조회수 집계 구현시 동일 사용자가 새로고침할 때마다 계속해서 조회수가 증가**
  - 특정한 조건 없이 해당 이력서를 조회할 때마다 조회수가 올라가는 것은 조회수 정보의 신뢰성을 떨어뜨릴 수 있다고 판단

  #### 2️⃣ **MongoDB에서 페이지네이션 적용시 10만건 데이터 기준 총 8000 페이지에서 약 4000 페이지부터 메모리 관련 에러 발생**
  #### 3️⃣ **배치 작업 시 Kafka와 Spring Batch의 트랜잭션 충돌 문제 발생**
